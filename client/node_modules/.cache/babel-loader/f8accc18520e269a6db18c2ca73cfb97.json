{"ast":null,"code":"var _jsxFileName = \"/Users/uayevan/Desktop/ChessApp/client/src/components/Board.js\",\n    _s = $RefreshSig$();\n\nimport React from 'react';\nimport $ from 'jquery';\nimport ChessBoard from './ChessBoard.js';\nimport Chess from 'chess.js';\nimport { useState, useEffect, useContext, memo } from 'react';\nimport { Tab, Tabs, TabList, TabPanel } from 'react-tabs';\nimport { useLocation, Link } from 'react-router-dom';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar engine = new Worker('stockfish.js');\nvar evaler = new Worker('stockfish.js');\nvar engineStatus = {};\n\nfunction Board(props) {\n  _s();\n\n  const [selected, setSelected] = useState('x');\n  const [position, setPosition] = useState('start');\n  const [chess, setChess] = useState(new Chess());\n  const [squareStyles, setSquareStyles] = useState({});\n  const [moves, setMoves] = useState([]);\n  const [positions, setPositions] = useState(['start']);\n  const [positionIndex, setPositionIndex] = useState(0);\n  const [moveable, setMoveable] = useState('false');\n  const [whiteTimer, setWhiteTimer] = useState(props.timer);\n  const [blackTimer, setBlackTimer] = useState(props.timer);\n  const [gameRunning, setGameRunning] = useState('running');\n  const [gameEndReason, setGameEndReason] = useState('');\n  const bot = props.color.charAt(0);\n\n  const changePosition = index => {\n    if (index >= 0 && index <= positions.length - 1) {\n      setPosition(positions[index]);\n      setPositionIndex(index);\n      if (positions[index] === positions[positions.length - 1]) setMoveable('true');else setMoveable('false');\n    }\n  };\n\n  const convertToTuples = array => {\n    //[a, b, c, d, e] => [[a, b], [c, d], [e]]\n    var newArray = [];\n\n    for (var i = 0; i < array.length; i = i + 2) {\n      if (i >= array.length) break;else if (i + 1 < array.length) {\n        newArray.push([array[i], array[i + 1]]);\n      } else {\n        newArray.push([array[i]]);\n      }\n    }\n\n    return newArray;\n  };\n\n  const move = theMove => {\n    if (moveable && gameRunning === \"running\" && theMove.piece.charAt(0) === chess.turn()) {\n      console.log(theMove);\n      chess.move({\n        from: theMove.sourceSquare,\n        to: theMove.targetSquare,\n        promotion: 'q'\n      });\n      setMoves(convertToTuples(chess.history()));\n      var newArray = positions;\n      newArray.push(chess.fen());\n      setPositions(newArray);\n      setPositionIndex(positionIndex + 1);\n      setPosition(chess.fen());\n\n      if (chess.turn() === \"b\") {\n        setTimeout(() => setWhiteTimer(whiteTimer + parseInt(props.increment)), 1000);\n      } else {}\n    }\n  };\n\n  const movePiece = square => {\n    if (moveable && gameRunning === \"running\") {\n      if (chess.get(square) && chess.get(square).color === chess.turn()) {\n        setSelected(square);\n        let highlightedSquares = {};\n        highlightedSquares[square] = {\n          backgroundColor: \"#0000ff\"\n        };\n        let moves = chess.moves({\n          square: square,\n          verbose: true\n        });\n\n        if (moves.length === 0) {\n          setSelected('x');\n          setSquareStyles({});\n          return;\n        }\n\n        let squaresToHighlight = [];\n\n        for (var i = 0; i < moves.length; i++) {\n          squaresToHighlight.push(moves[i].to);\n        }\n\n        for (var i = 0; i < squaresToHighlight.length; i++) {\n          highlightedSquares[squaresToHighlight[i]] = {\n            background: \"radial-gradient(circle, #0000ff 20%, transparent 40%)\",\n            borderRadius: \"50%\"\n          };\n        }\n\n        setSquareStyles(highlightedSquares);\n      } else if (selected !== 'x') {\n        setSelected('x');\n        setSquareStyles({});\n        chess.move({\n          from: selected,\n          to: square,\n          promotion: 'q'\n        });\n        setMoves(convertToTuples(chess.history()));\n        var newArray = positions;\n        newArray.push(chess.fen());\n        setPositions(newArray);\n        changePosition(newArray.length - 1);\n\n        if (chess.turn() === \"b\") {\n          setTimeout(() => setWhiteTimer(whiteTimer + parseInt(props.increment)), 1000);\n        } else {\n          setTimeout(() => setBlackTimer(blackTimer + parseInt(props.increment)), 1000);\n        }\n      }\n    }\n  };\n\n  const formatTime = stopwatch => {\n    var time = new Date(stopwatch * 1000).toISOString().substr(14, 5);\n    return time;\n  };\n\n  useEffect(() => {\n    if (whiteTimer > 0 && blackTimer > 0 && chess.in_checkmate() === false && chess.in_threefold_repetition() === false && chess.in_stalemate() === false) {\n      if (chess.turn() === \"w\") {\n        setTimeout(() => setWhiteTimer(whiteTimer - 1), 1000);\n      } else {\n        setTimeout(() => setBlackTimer(blackTimer - 1), 1000);\n      }\n    } else {\n      if (chess.in_checkmate() === true) {\n        if (chess.turn() === 'w') setGameRunning('Black');else setGameRunning('White');\n        setGameEndReason('checkmate');\n      } else if (chess.in_stalemate() === true) {\n        if (chess.turn() === 'w') setGameRunning('Black');else setGameRunning('White');\n        setGameEndReason('stalemate');\n      } else if (chess.in_threefold_repetition() === true) {\n        if (chess.turn() === 'w') setGameRunning('Black');else setGameRunning('White');\n        setGameEndReason('threefold repetition');\n      } else if (whiteTimer <= 0) {\n        setGameRunning('Black');\n        setGameEndReason('timeout');\n      } else if (blackTimer <= 0) {\n        setGameRunning('White');\n        setGameEndReason('timeout');\n      }\n    }\n  }, [whiteTimer, blackTimer, chess]);\n\n  function uciCmd(cmd, which) {\n    // console.log('UCI: ' + cmd);\n    (which || engine).postMessage(cmd);\n  }\n\n  uciCmd(\"uci\");\n\n  function get_moves() {\n    let moves = \"\";\n    let history = chess.history({\n      verbose: true\n    });\n\n    for (let i = 0; i < history.length; ++i) {\n      let move = history[i];\n      moves += \" \" + move.from + move.to + (move.promotion ? move.promotion : \"\");\n    }\n\n    return moves;\n  }\n\n  const prepareMove = () => {\n    if (gameRunning) {\n      if (chess.turn() === bot) {\n        // playerColor = playerColor === 'white' ? 'black' : 'white';\n        uciCmd(\"position startpos moves\" + get_moves());\n        uciCmd(\"position startpos moves\" + get_moves(), evaler);\n        uciCmd(\"eval\", evaler); // isEngineRunning = true;\n      }\n    }\n  };\n\n  evaler.onmessage = function (event) {\n    let line;\n\n    if (event && typeof event === \"object\") {\n      line = event.data;\n    } else {\n      line = event;\n    } // console.log('evaler: ' + line);\n    /// Ignore some output.\n\n\n    if (line === \"uciok\" || line === \"readyok\" || line.substr(0, 11) === \"option name\") {\n      return;\n    }\n  };\n\n  engine.onmessage = event => {\n    let line;\n\n    if (event && typeof event === \"object\") {\n      line = event.data;\n    } else {\n      line = event;\n    }\n\n    console.log(line); // console.log('Reply: ' + line);\n\n    if (line === \"uciok\") {\n      engineStatus.engineLoaded = true;\n    } else if (line === \"readyok\") {\n      engineStatus.engineReady = true;\n    } else {\n      let match = line.match(/^bestmove ([a-h][1-8])([a-h][1-8])([qrbn])?/); /// Did the AI move?\n\n      if (match) {\n        // isEngineRunning = false;\n        chess.move({\n          from: match[1],\n          to: match[2],\n          promotion: match[3]\n        });\n        setPosition(chess.fen());\n        prepareMove();\n        uciCmd(\"eval\", evaler); //uciCmd(\"eval\");\n        /// Is it sending feedback?\n      } else if (match = line.match(/^info .*\\bdepth (\\d+) .*\\bnps (\\d+)/)) {\n        engineStatus.search = \"Depth: \" + match[1] + \" Nps: \" + match[2];\n      } /// Is it sending feed back with a score?\n\n\n      if (match = line.match(/^info .*\\bscore (\\w+) (-?\\d+)/)) {\n        let score = parseInt(match[2], 10) * (chess.turn() === \"w\" ? 1 : -1); /// Is it measuring in centipawns?\n\n        if (match[1] === \"cp\") {\n          engineStatus.score = (score / 100.0).toFixed(2); /// Did it find a mate?\n        } else if (match[1] === \"mate\") {\n          engineStatus.score = \"Mate in \" + Math.abs(score);\n        } /// Is the score bounded?\n\n\n        if (match = line.match(/\\b(upper|lower)bound\\b/)) {\n          engineStatus.score = (match[1] === \"upper\" === (chess.turn() === \"w\") ? \"<= \" : \">= \") + engineStatus.score;\n        }\n      }\n    } // displayStatus();\n\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(ChessBoard, {\n        orientation: props.color,\n        width: 600,\n        position: position,\n        onDrop: move,\n        onSquareClick: movePiece,\n        squareStyles: squareStyles\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 284,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 283,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'absolute',\n        backgroundColor: 'white',\n        fontSize: '36px',\n        width: '140px',\n        textAlign: 'right',\n        borderRadius: '6px',\n        left: '460px',\n        top: '624px'\n      },\n      children: props.color === \"white\" ? formatTime(whiteTimer) : formatTime(blackTimer)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 287,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'absolute',\n        backgroundColor: 'white',\n        fontSize: '36px',\n        width: '140px',\n        textAlign: 'right',\n        borderRadius: '6px',\n        left: '460px',\n        top: '-30px'\n      },\n      children: props.color === \"white\" ? formatTime(blackTimer) : formatTime(whiteTimer)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 298,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        overflow: 'scroll',\n        display: 'inline-block',\n        height: '600px',\n        width: '200px',\n        position: 'absolute',\n        top: '20px',\n        right: '-250px',\n        color: 'white',\n        backgroundColor: 'black'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          width: 'auto',\n          textAlign: 'center',\n          fontSize: '24px'\n        },\n        children: \"Game Moves\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 311,\n        columnNumber: 17\n      }, this), moves.map((move, i) => /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          display: 'flex',\n          justifyContent: 'space-between',\n          width: '160px'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            position: 'absolute',\n            left: '0px'\n          },\n          children: [\"\\xA0\", i + 1]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 316,\n          columnNumber: 29\n        }, this), positionIndex === 2 * i + 1 ? /*#__PURE__*/_jsxDEV(\"span\", {\n          onClick: () => changePosition(2 * i + 1),\n          style: {\n            position: 'absolute',\n            left: '40px',\n            backgroundColor: 'white',\n            color: 'black'\n          },\n          children: move[0]\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 318,\n          columnNumber: 33\n        }, this) : /*#__PURE__*/_jsxDEV(\"span\", {\n          onClick: () => changePosition(2 * i + 1),\n          style: {\n            position: 'absolute',\n            left: '40px'\n          },\n          children: move[0]\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 320,\n          columnNumber: 33\n        }, this), positionIndex === 2 * i + 2 ? /*#__PURE__*/_jsxDEV(\"span\", {\n          onClick: () => changePosition(2 * i + 2),\n          style: {\n            position: 'absolute',\n            left: '120px',\n            backgroundColor: 'white',\n            color: 'black'\n          },\n          children: move[1]\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 323,\n          columnNumber: 33\n        }, this) : /*#__PURE__*/_jsxDEV(\"span\", {\n          onClick: () => changePosition(2 * i + 2),\n          style: {\n            position: 'absolute',\n            left: '120px'\n          },\n          children: move[1]\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 325,\n          columnNumber: 33\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 328,\n          columnNumber: 29\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 315,\n        columnNumber: 25\n      }, this))]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 310,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        textAlign: 'center',\n        backgroundColor: 'white',\n        width: '200px',\n        position: 'absolute',\n        top: '620px',\n        right: '-250px',\n        height: '40px'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        onClick: () => changePosition(0),\n        style: {\n          fontSize: '36px'\n        },\n        children: \"\\xAB\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 334,\n        columnNumber: 17\n      }, this), \"\\xA0 \\xA0\", /*#__PURE__*/_jsxDEV(\"span\", {\n        onClick: () => changePosition(positionIndex - 1),\n        style: {\n          fontSize: '36px'\n        },\n        children: \"<\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 337,\n        columnNumber: 17\n      }, this), \"\\xA0 \\xA0 \\xA0\", /*#__PURE__*/_jsxDEV(\"span\", {\n        onClick: () => changePosition(positionIndex + 1),\n        style: {\n          fontSize: '36px'\n        },\n        children: \">\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 341,\n        columnNumber: 17\n      }, this), \"\\xA0 \\xA0\", /*#__PURE__*/_jsxDEV(\"span\", {\n        onClick: () => changePosition(positions.length - 1),\n        style: {\n          fontSize: '36px'\n        },\n        children: \"\\xBB\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 344,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 333,\n      columnNumber: 13\n    }, this), gameRunning !== 'running' ? gameEndReason === 'checkmate' || gameEndReason === 'timeout' ? /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'absolute',\n        fontSize: '36px',\n        backgroundColor: 'white',\n        bottom: '-100px',\n        borderRadius: '8px'\n      },\n      children: [gameRunning, \" won the game by \", gameEndReason, \"!\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 349,\n      columnNumber: 25\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'absolute',\n        fontSize: '36px',\n        backgroundColor: 'white',\n        bottom: '-100px',\n        borderRadius: '8px'\n      },\n      children: [\"Game ended in a draw by \", gameEndReason, \"!\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 357,\n      columnNumber: 25\n    }, this) : null]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 282,\n    columnNumber: 9\n  }, this);\n}\n\n_s(Board, \"L7EeHjoFynIxicnlZP089XV4xj0=\");\n\n_c = Board;\nexport default _c2 = /*#__PURE__*/memo(Board);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Board\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"sources":["/Users/uayevan/Desktop/ChessApp/client/src/components/Board.js"],"names":["React","$","ChessBoard","Chess","useState","useEffect","useContext","memo","Tab","Tabs","TabList","TabPanel","useLocation","Link","axios","engine","Worker","evaler","engineStatus","Board","props","selected","setSelected","position","setPosition","chess","setChess","squareStyles","setSquareStyles","moves","setMoves","positions","setPositions","positionIndex","setPositionIndex","moveable","setMoveable","whiteTimer","setWhiteTimer","timer","blackTimer","setBlackTimer","gameRunning","setGameRunning","gameEndReason","setGameEndReason","bot","color","charAt","changePosition","index","length","convertToTuples","array","newArray","i","push","move","theMove","piece","turn","console","log","from","sourceSquare","to","targetSquare","promotion","history","fen","setTimeout","parseInt","increment","movePiece","square","get","highlightedSquares","backgroundColor","verbose","squaresToHighlight","background","borderRadius","formatTime","stopwatch","time","Date","toISOString","substr","in_checkmate","in_threefold_repetition","in_stalemate","uciCmd","cmd","which","postMessage","get_moves","prepareMove","onmessage","event","line","data","engineLoaded","engineReady","match","search","score","toFixed","Math","abs","fontSize","width","textAlign","left","top","overflow","display","height","right","map","justifyContent","bottom"],"mappings":"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","sourcesContent":["import React from 'react';\nimport $ from 'jquery'\nimport ChessBoard from './ChessBoard.js'\nimport Chess from 'chess.js'\nimport { useState, useEffect, useContext, memo } from 'react';\nimport { Tab, Tabs, TabList, TabPanel } from 'react-tabs';\nimport { useLocation, Link } from 'react-router-dom';\nimport axios from 'axios';\nvar engine = new Worker('stockfish.js');\nvar evaler = new Worker('stockfish.js');\nvar engineStatus = {}\n\nfunction Board(props) {\n    const [selected, setSelected] = useState('x')\n    const [position, setPosition] = useState('start')\n    const [chess, setChess] = useState(new Chess())\n    const [squareStyles, setSquareStyles] = useState({})\n    const [moves, setMoves] = useState([])\n    const [positions, setPositions] = useState(['start'])\n    const [positionIndex, setPositionIndex] = useState(0)\n    const [moveable, setMoveable] = useState('false')\n    const [whiteTimer, setWhiteTimer] = useState(props.timer)\n    const [blackTimer, setBlackTimer] = useState(props.timer)\n    const [gameRunning, setGameRunning] = useState('running')\n    const [gameEndReason, setGameEndReason] = useState('')\n\n    const bot = props.color.charAt(0);\n\n    const changePosition = (index) => {\n        if (index >= 0 && index <= positions.length - 1) {\n            setPosition(positions[index]);\n            setPositionIndex(index);\n            if (positions[index] === positions[positions.length - 1])\n                setMoveable('true')\n            else\n                setMoveable('false')\n        }\n    }\n\n    const convertToTuples = (array) => {\n        //[a, b, c, d, e] => [[a, b], [c, d], [e]]\n        var newArray = [];\n        for (var i = 0; i < array.length; i = i + 2) {\n            if (i >= array.length)\n                break;\n            else if (i + 1 < array.length) {\n                newArray.push([array[i], array[i + 1]])\n            }\n            else {\n                newArray.push([array[i]])\n            }\n        }\n        return newArray;\n    }\n    const move = (theMove) => {\n        if (moveable && gameRunning === \"running\" && theMove.piece.charAt(0) === chess.turn()) {\n            console.log(theMove)\n            chess.move({ from: theMove.sourceSquare, to: theMove.targetSquare, promotion: 'q' })\n            setMoves(convertToTuples(chess.history()))\n            var newArray = positions\n            newArray.push(chess.fen())\n            setPositions(newArray)\n            setPositionIndex(positionIndex + 1);\n            setPosition(chess.fen())\n            if (chess.turn() === \"b\") {\n                setTimeout(() => setWhiteTimer(whiteTimer + parseInt(props.increment)), 1000)\n            }\n            else {\n            }\n        }\n    }\n\n    const movePiece = (square) => {\n        if (moveable && gameRunning === \"running\") {\n            if (chess.get(square) && chess.get(square).color === chess.turn()) {\n                setSelected(square)\n                let highlightedSquares = {};\n                highlightedSquares[square] =\n                {\n                    backgroundColor: \"#0000ff\"\n                }\n                let moves = chess.moves({\n                    square: square,\n                    verbose: true\n                });\n                if (moves.length === 0) {\n                    setSelected('x');\n                    setSquareStyles({})\n                    return;\n                }\n\n                let squaresToHighlight = [];\n                for (var i = 0; i < moves.length; i++) {\n                    squaresToHighlight.push(moves[i].to);\n                }\n                for (var i = 0; i < squaresToHighlight.length; i++) {\n                    highlightedSquares[squaresToHighlight[i]] =\n                    {\n                        background:\n                            \"radial-gradient(circle, #0000ff 20%, transparent 40%)\",\n                        borderRadius: \"50%\"\n                    }\n                }\n                setSquareStyles(highlightedSquares)\n            }\n            else if (selected !== 'x') {\n                setSelected('x');\n                setSquareStyles({});\n                chess.move({ from: selected, to: square, promotion: 'q' });\n                setMoves(convertToTuples(chess.history()));\n                var newArray = positions;\n                newArray.push(chess.fen());\n                setPositions(newArray);\n                changePosition(newArray.length - 1);\n                if (chess.turn() === \"b\") {\n                    setTimeout(() => setWhiteTimer(whiteTimer + parseInt(props.increment)), 1000)\n                }\n                else {\n                    setTimeout(() => setBlackTimer(blackTimer + parseInt(props.increment)), 1000)\n                }\n            }\n        }\n    }\n\n    const formatTime = (stopwatch) => {\n        var time = new Date(stopwatch * 1000).toISOString().substr(14, 5);\n        return time;\n    }\n\n    useEffect(() => {\n        if (whiteTimer > 0 && blackTimer > 0 && chess.in_checkmate() === false &&\n            chess.in_threefold_repetition() === false && chess.in_stalemate() === false) {\n            if (chess.turn() === \"w\") {\n                setTimeout(() => setWhiteTimer(whiteTimer - 1), 1000)\n            }\n            else {\n                setTimeout(() => setBlackTimer(blackTimer - 1), 1000)\n            }\n        }\n        else {\n            if (chess.in_checkmate() === true) {\n                if (chess.turn() === 'w')\n                    setGameRunning('Black')\n                else\n                    setGameRunning('White')\n                setGameEndReason('checkmate')\n            }\n            else if (chess.in_stalemate() === true) {\n                if (chess.turn() === 'w')\n                    setGameRunning('Black')\n                else\n                    setGameRunning('White')\n                setGameEndReason('stalemate')\n            }\n            else if (chess.in_threefold_repetition() === true) {\n                if (chess.turn() === 'w')\n                    setGameRunning('Black')\n                else\n                    setGameRunning('White')\n                setGameEndReason('threefold repetition')\n\n            }\n            else if (whiteTimer <= 0) {\n                setGameRunning('Black')\n                setGameEndReason('timeout')\n            }\n            else if (blackTimer <= 0) {\n                setGameRunning('White')\n                setGameEndReason('timeout')\n            }\n        }\n    }, [whiteTimer, blackTimer, chess])\n\n    function uciCmd(cmd, which) {\n        // console.log('UCI: ' + cmd);\n\n        (which || engine).postMessage(cmd);\n    }\n    uciCmd(\"uci\");\n\n    function get_moves() {\n        let moves = \"\";\n        let history = chess.history({ verbose: true });\n\n        for (let i = 0; i < history.length; ++i) {\n            let move = history[i];\n            moves +=\n                \" \" + move.from + move.to + (move.promotion ? move.promotion : \"\");\n        }\n\n        return moves;\n    }\n\n    const prepareMove = () => {\n        if (gameRunning) {\n            if (chess.turn() === bot) {\n                // playerColor = playerColor === 'white' ? 'black' : 'white';\n                uciCmd(\"position startpos moves\" + get_moves());\n                uciCmd(\"position startpos moves\" + get_moves(), evaler);\n                uciCmd(\"eval\", evaler);\n\n                // isEngineRunning = true;\n            }\n        }\n    };\n\n    evaler.onmessage = function (event) {\n        let line;\n\n        if (event && typeof event === \"object\") {\n            line = event.data;\n        } else {\n            line = event;\n        }\n\n        // console.log('evaler: ' + line);\n\n        /// Ignore some output.\n        if (\n            line === \"uciok\" ||\n            line === \"readyok\" ||\n            line.substr(0, 11) === \"option name\"\n        ) {\n            return;\n        }\n    };\n\n    engine.onmessage = event => {\n        let line;\n        if (event && typeof event === \"object\") {\n            line = event.data;\n        } else {\n            line = event;\n        }\n        console.log(line);\n        // console.log('Reply: ' + line);\n        if (line === \"uciok\") {\n            engineStatus.engineLoaded = true;\n        } else if (line === \"readyok\") {\n            engineStatus.engineReady = true;\n        } else {\n            let match = line.match(/^bestmove ([a-h][1-8])([a-h][1-8])([qrbn])?/);\n            /// Did the AI move?\n            if (match) {\n                // isEngineRunning = false;\n                chess.move({ from: match[1], to: match[2], promotion: match[3] });\n                setPosition(chess.fen())\n                prepareMove();\n                uciCmd(\"eval\", evaler);\n                //uciCmd(\"eval\");\n                /// Is it sending feedback?\n            } else if (\n                (match = line.match(/^info .*\\bdepth (\\d+) .*\\bnps (\\d+)/))\n            ) {\n                engineStatus.search = \"Depth: \" + match[1] + \" Nps: \" + match[2];\n            }\n\n            /// Is it sending feed back with a score?\n            if ((match = line.match(/^info .*\\bscore (\\w+) (-?\\d+)/))) {\n                let score = parseInt(match[2], 10) * (chess.turn() === \"w\" ? 1 : -1);\n                /// Is it measuring in centipawns?\n                if (match[1] === \"cp\") {\n                    engineStatus.score = (score / 100.0).toFixed(2);\n                    /// Did it find a mate?\n                } else if (match[1] === \"mate\") {\n                    engineStatus.score = \"Mate in \" + Math.abs(score);\n                }\n\n                /// Is the score bounded?\n                if ((match = line.match(/\\b(upper|lower)bound\\b/))) {\n                    engineStatus.score =\n                        ((match[1] === \"upper\") === (chess.turn() === \"w\")\n                            ? \"<= \"\n                            : \">= \") + engineStatus.score;\n                }\n            }\n        }\n        // displayStatus();\n    };\n\n    return (\n        <div>\n            <div>\n                <ChessBoard orientation={props.color} width={600}\n                    position={position} onDrop={move} onSquareClick={movePiece} squareStyles={squareStyles} />\n            </div>\n            <div style={{\n                position: 'absolute', backgroundColor: 'white',\n                fontSize: '36px', width: '140px', textAlign: 'right',\n                borderRadius: '6px', left: '460px', top: '624px'\n            }}>\n                {props.color === \"white\" ?\n                    formatTime(whiteTimer)\n                    :\n                    formatTime(blackTimer)\n                }\n            </div>\n            <div style={{\n                position: 'absolute', backgroundColor: 'white',\n                fontSize: '36px', width: '140px', textAlign: 'right',\n                borderRadius: '6px', left: '460px', top: '-30px'\n            }}>\n                {props.color === \"white\" ?\n                    formatTime(blackTimer)\n                    :\n                    formatTime(whiteTimer)\n                }\n            </div>\n\n            <div style={{ overflow: 'scroll', display: 'inline-block', height: '600px', width: '200px', position: 'absolute', top: '20px', right: '-250px', color: 'white', backgroundColor: 'black' }}>\n                <div style={{ width: 'auto', textAlign: 'center', fontSize: '24px' }}>Game Moves</div>\n\n                {\n                    moves.map((move, i) => (\n                        <p style={{ display: 'flex', justifyContent: 'space-between', width: '160px' }}>\n                            <span style={{ position: 'absolute', left: '0px' }}>&nbsp;{i + 1}</span>\n                            {positionIndex === 2 * i + 1 ?\n                                <span onClick={() => changePosition(2 * i + 1)} style={{ position: 'absolute', left: '40px', backgroundColor: 'white', color: 'black' }}>{move[0]}</span>\n                                :\n                                <span onClick={() => changePosition(2 * i + 1)} style={{ position: 'absolute', left: '40px' }}>{move[0]}</span>\n                            }\n                            {positionIndex === 2 * i + 2 ?\n                                <span onClick={() => changePosition(2 * i + 2)} style={{ position: 'absolute', left: '120px', backgroundColor: 'white', color: 'black' }}>{move[1]}</span>\n                                :\n                                <span onClick={() => changePosition(2 * i + 2)} style={{ position: 'absolute', left: '120px' }}>{move[1]}</span>\n                            }\n\n                            <br />\n                        </p>\n                    ))\n                }\n            </div>\n            <div style={{ textAlign: 'center', backgroundColor: 'white', width: '200px', position: 'absolute', top: '620px', right: '-250px', height: '40px' }}>\n                <span onClick={() => changePosition(0)} style={{ fontSize: '36px' }}>&laquo;</span>\n                &nbsp;\n                &nbsp;\n                <span onClick={() => changePosition(positionIndex - 1)} style={{ fontSize: '36px' }}>&lt;</span>\n                &nbsp;\n                &nbsp;\n                &nbsp;\n                <span onClick={() => changePosition(positionIndex + 1)} style={{ fontSize: '36px' }}>&gt;</span>\n                &nbsp;\n                &nbsp;\n                <span onClick={() => changePosition(positions.length - 1)} style={{ fontSize: '36px' }}>&raquo;</span>\n            </div>\n            {\n                gameRunning !== 'running' ?\n                    gameEndReason === 'checkmate' || gameEndReason === 'timeout' ?\n                        <div style={{\n                            position: 'absolute', fontSize: '36px',\n                            backgroundColor: 'white', bottom: '-100px',\n                            borderRadius: '8px'\n                        }}>\n                            {gameRunning} won the game by {gameEndReason}!\n                        </div>\n                        :\n                        <div style={{\n                            position: 'absolute', fontSize: '36px',\n                            backgroundColor: 'white', bottom: '-100px',\n                            borderRadius: '8px'\n                        }}>\n                            Game ended in a draw by {gameEndReason}!\n                        </div>\n                    :\n                    null\n            }\n        </div>\n    );\n}\n\nexport default memo(Board);\n"]},"metadata":{},"sourceType":"module"}